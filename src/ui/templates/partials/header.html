<!-- 
  Header Component for 3AI Dashboard
  =================================
  Main navigation and global actions including:
  - Logo and branding
  - Primary navigation
  - User menu and settings
  - Global search
-->

<header class="header bg-surface border-b border-border" role="banner">
  <div class="container mx-auto">
    <div class="header-content h-16">
      <!-- Logo and Brand -->
      <div class="flex items-center gap-2">
        <a href="/" class="flex items-center gap-2" aria-label="3AI Dashboard Home">
          <img 
            src="/static/images/logo.svg" 
            alt="3AI Logo" 
            width="32" 
            height="32"
            class="w-8 h-8"
          >
          <span class="text-xl font-bold text-primary hidden sm:inline">
            3AI Dashboard
          </span>
        </a>
      </div>

      <!-- Main Navigation -->
      <nav class="nav hidden md:flex" role="navigation" aria-label="Main navigation">
        <ul class="flex items-center gap-6">
          <li>
            <a 
              href="/" 
              class="nav-link {{ 'active' if request.endpoint == 'index' }}"
              aria-current="{{ 'page' if request.endpoint == 'index' }}"
            >
              Dashboard
            </a>
          </li>
          <li>
            <a 
              href="/reports" 
              class="nav-link {{ 'active' if request.endpoint == 'reports' }}"
              aria-current="{{ 'page' if request.endpoint == 'reports' }}"
            >
              Reports
            </a>
          </li>
          <li>
            <a 
              href="/settings" 
              class="nav-link {{ 'active' if request.endpoint == 'settings' }}"
              aria-current="{{ 'page' if request.endpoint == 'settings' }}"
            >
              Settings
            </a>
          </li>
        </ul>
      </nav>

      <!-- Right Side Actions -->
      <div class="flex items-center gap-4">
        <!-- Global Search -->
        <div class="hidden md:block">
          <form 
            role="search" 
            class="relative"
            action="/search" 
            method="GET"
          >
            <input
              type="search"
              name="q"
              placeholder="Search..."
              class="form-input pl-10 pr-4 py-2 w-64"
              aria-label="Search dashboard"
            >
            <svg 
              class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted"
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                stroke-width="2" 
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </form>
        </div>

        <!-- User Menu -->
        <div class="relative">
          <button
            id="user-menu-button"
            class="flex items-center gap-2"
            aria-expanded="false"
            aria-haspopup="true"
            aria-controls="user-menu"
          >
            <img
              src="/static/images/avatar.png"
              alt=""
              class="w-8 h-8 rounded-full"
              width="32"
              height="32"
            >
            <span class="hidden sm:inline">Admin</span>
          </button>

          <!-- Dropdown Menu -->
          <div
            id="user-menu"
            class="hidden absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1"
            role="menu"
            aria-orientation="vertical"
            aria-labelledby="user-menu-button"
          >
            <a
              href="/profile"
              class="block px-4 py-2 text-sm hover:bg-primary/10"
              role="menuitem"
            >
              Your Profile
            </a>
            <a
              href="/settings"
              class="block px-4 py-2 text-sm hover:bg-primary/10"
              role="menuitem"
            >
              Settings
            </a>
            <hr class="my-1 border-border">
            <button
              onclick="handleLogout()"
              class="block w-full text-left px-4 py-2 text-sm text-error hover:bg-error/10"
              role="menuitem"
            >
              Sign out
            </button>
          </div>
        </div>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-button"
          class="md:hidden"
          aria-expanded="false"
          aria-controls="mobile-menu"
          aria-label="Open main menu"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div
      id="mobile-menu"
      class="hidden md:hidden"
      role="navigation"
      aria-label="Mobile navigation"
    >
      <div class="px-2 pt-2 pb-3 space-y-1">
        <a
          href="/"
          class="block px-3 py-2 rounded-md {{ 'bg-primary text-white' if request.endpoint == 'index' }}"
        >
          Dashboard
        </a>
        <a
          href="/reports"
          class="block px-3 py-2 rounded-md {{ 'bg-primary text-white' if request.endpoint == 'reports' }}"
        >
          Reports
        </a>
        <a
          href="/settings"
          class="block px-3 py-2 rounded-md {{ 'bg-primary text-white' if request.endpoint == 'settings' }}"
        >
          Settings
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Header Scripts -->
<script>
  // Toggle user menu
  const userMenuButton = document.getElementById('user-menu-button');
  const userMenu = document.getElementById('user-menu');

  if (userMenuButton && userMenu) {
    userMenuButton.addEventListener('click', () => {
      const expanded = userMenuButton.getAttribute('aria-expanded') === 'true';
      userMenuButton.setAttribute('aria-expanded', !expanded);
      userMenu.classList.toggle('hidden');
    });
  }

  // Toggle mobile menu
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', () => {
      const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
      mobileMenuButton.setAttribute('aria-expanded', !expanded);
      mobileMenu.classList.toggle('hidden');
    });
  }

  // Close menus when clicking outside
  document.addEventListener('click', (event) => {
    if (!event.target.closest('#user-menu-button')) {
      userMenu?.classList.add('hidden');
      userMenuButton?.setAttribute('aria-expanded', 'false');
    }
    if (!event.target.closest('#mobile-menu-button')) {
      mobileMenu?.classList.add('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'false');
    }
  });
</script>
