<!DOCTYPE html>
<html lang="en">
<head>
    <!--
      üìå Settings Page - 3AI Dashboard
      ======================================
      This page allows users to configure their system preferences,
      update theme settings, and manage notifications.

      üîπ Features:
      - Dropdown selection for dark/light mode theme.
      - Toggle for enabling/disabling email notifications.
      - Form submission for saving preferences.

      üîπ Best Practices:
      - Uses semantic HTML for accessibility.
      - Implements modular layout for maintainability.
      - Fully responsive and mobile-friendly.

      ‚è≥ Last Updated: 2025-02-23
    -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="3AI Dashboard Settings - Configure your AI agent preferences">
    <title>Settings - 3AI Dashboard</title>
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/static/css/style.css" as="style">
    <link rel="preload" href="/static/js/main.js" as="script">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only focus:not-sr-only">
        Skip to main content
    </a>

    <!-- üîπ Include the navigation/header component -->
    {% include 'partials/header.html' %}

    <main id="main-content" class="container mx-auto py-6" role="main">
        <!-- Page Header -->
        <div class="mb-6">
            <h1 class="text-2xl font-bold">Settings</h1>
            <p class="text-muted">Configure your dashboard preferences and agent settings</p>
        </div>

        <!-- Settings Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Settings Navigation -->
            <nav class="lg:col-span-1" aria-label="Settings navigation">
                <div class="card sticky top-6">
                    <div class="p-4">
                        <ul class="space-y-2">
                            <li>
                                <a 
                                    href="#general"
                                    class="block px-4 py-2 rounded-md hover:bg-primary/10 active"
                                    aria-current="true"
                                >
                                    General Settings
                                </a>
                            </li>
                            <li>
                                <a 
                                    href="#agents"
                                    class="block px-4 py-2 rounded-md hover:bg-primary/10"
                                >
                                    Agent Configuration
                                </a>
                            </li>
                            <li>
                                <a 
                                    href="#notifications"
                                    class="block px-4 py-2 rounded-md hover:bg-primary/10"
                                >
                                    Notifications
                                </a>
                            </li>
                            <li>
                                <a 
                                    href="#api"
                                    class="block px-4 py-2 rounded-md hover:bg-primary/10"
                                >
                                    API Settings
                                </a>
                            </li>
                            <li>
                                <a 
                                    href="#security"
                                    class="block px-4 py-2 rounded-md hover:bg-primary/10"
                                >
                                    Security
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Settings Content -->
            <div class="lg:col-span-3 space-y-6">
                <!-- General Settings -->
                <section id="general" class="card" aria-labelledby="general-title">
                    <div class="card-header">
                        <h2 id="general-title" class="text-lg font-semibold">General Settings</h2>
                    </div>
                    <div class="card-body">
                        <form id="general-settings-form" class="space-y-4">
                            <!-- Theme Selection -->
                            <div class="form-group">
                                <label for="theme" class="form-label">Theme</label>
                                <select id="theme" name="theme" class="form-input">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                    <option value="system">System Default</option>
                                </select>
                            </div>

                            <!-- Language Selection -->
                            <div class="form-group">
                                <label for="language" class="form-label">Language</label>
                                <select id="language" name="language" class="form-input">
                                    <option value="en">English</option>
                                    <option value="es">Espa√±ol</option>
                                    <option value="fr">Fran√ßais</option>
                                </select>
                            </div>

                            <!-- Timezone Selection -->
                            <div class="form-group">
                                <label for="timezone" class="form-label">Timezone</label>
                                <select id="timezone" name="timezone" class="form-input">
                                    <!-- Dynamically populated -->
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                Save General Settings
                            </button>
                        </form>
                    </div>
                </section>

                <!-- Agent Configuration -->
                <section id="agents" class="card" aria-labelledby="agents-title">
                    <div class="card-header">
                        <h2 id="agents-title" class="text-lg font-semibold">Agent Configuration</h2>
                    </div>
                    <div class="card-body">
                        <div class="space-y-6">
                            {% for agent in agents %}
                            <div class="border-b border-border pb-6 last:border-0 last:pb-0">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-medium">{{ agent.name }}</h3>
                                    <div class="flex items-center gap-2">
                                        <span class="status-indicator status-{{ agent.status }}"></span>
                                        <span class="text-sm">{{ agent.status }}</span>
                                    </div>
                                </div>
                                <form class="space-y-4 agent-settings-form">
                                    <input type="hidden" name="agent_id" value="{{ agent.id }}">
                                    
                                    <!-- Agent Specific Settings -->
                                    <div class="form-group">
                                        <label class="form-label">Auto-start</label>
                                        <label class="flex items-center gap-2">
                                            <input 
                                                type="checkbox" 
                                                name="auto_start"
                                                {% if agent.auto_start %}checked{% endif %}
                                            >
                                            <span class="text-sm">Start agent automatically on system boot</span>
                                        </label>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Memory Limit (MB)</label>
                                        <input 
                                            type="number"
                                            name="memory_limit"
                                            class="form-input"
                                            value="{{ agent.memory_limit }}"
                                            min="128"
                                            max="4096"
                                        >
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Log Level</label>
                                        <select name="log_level" class="form-input">
                                            <option value="debug" {% if agent.log_level == 'debug' %}selected{% endif %}>Debug</option>
                                            <option value="info" {% if agent.log_level == 'info' %}selected{% endif %}>Info</option>
                                            <option value="warning" {% if agent.log_level == 'warning' %}selected{% endif %}>Warning</option>
                                            <option value="error" {% if agent.log_level == 'error' %}selected{% endif %}>Error</option>
                                        </select>
                                    </div>

                                    <button type="submit" class="btn btn-outline">
                                        Update Agent Settings
                                    </button>
                                </form>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </section>

                <!-- Notifications -->
                <section id="notifications" class="card" aria-labelledby="notifications-title">
                    <div class="card-header">
                        <h2 id="notifications-title" class="text-lg font-semibold">Notification Settings</h2>
                    </div>
                    <div class="card-body">
                        <form id="notification-settings-form" class="space-y-4">
                            <!-- Email Notifications -->
                            <div class="form-group">
                                <label class="form-label">Email Notifications</label>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" name="email_errors">
                                        <span>Agent Errors</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" name="email_warnings">
                                        <span>Agent Warnings</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" name="email_updates">
                                        <span>System Updates</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Slack Integration -->
                            <div class="form-group">
                                <label class="form-label">Slack Integration</label>
                                <input 
                                    type="text"
                                    name="slack_webhook"
                                    class="form-input"
                                    placeholder="Slack Webhook URL"
                                >
                            </div>

                            <button type="submit" class="btn btn-primary">
                                Save Notification Settings
                            </button>
                        </form>
                    </div>
                </section>

                <!-- API Settings -->
                <section id="api" class="card" aria-labelledby="api-title">
                    <div class="card-header">
                        <h2 id="api-title" class="text-lg font-semibold">API Settings</h2>
                    </div>
                    <div class="card-body">
                        <div class="space-y-4">
                            <!-- API Keys -->
                            <div>
                                <h3 class="text-sm font-medium mb-2">API Keys</h3>
                                <div class="bg-surface p-4 rounded-md">
                                    <code class="text-sm">{{ api_key }}</code>
                                    <button 
                                        class="btn btn-outline btn-sm ml-2"
                                        onclick="regenerateApiKey()"
                                    >
                                        Regenerate
                                    </button>
                                </div>
                            </div>

                            <!-- Rate Limiting -->
                            <form id="api-settings-form" class="space-y-4">
                                <div class="form-group">
                                    <label class="form-label">Rate Limit (requests/minute)</label>
                                    <input 
                                        type="number"
                                        name="rate_limit"
                                        class="form-input"
                                        value="60"
                                        min="10"
                                        max="1000"
                                    >
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    Update API Settings
                                </button>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Security Settings -->
                <section id="security" class="card" aria-labelledby="security-title">
                    <div class="card-header">
                        <h2 id="security-title" class="text-lg font-semibold">Security Settings</h2>
                    </div>
                    <div class="card-body">
                        <form id="security-settings-form" class="space-y-6">
                            <!-- 2FA -->
                            <div class="form-group">
                                <label class="form-label">Two-Factor Authentication</label>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input 
                                            type="checkbox" 
                                            name="enable_2fa"
                                            {% if user.has_2fa %}checked{% endif %}
                                        >
                                        <span>Enable 2FA</span>
                                    </label>
                                    {% if not user.has_2fa %}
                                    <button 
                                        type="button"
                                        class="btn btn-outline btn-sm"
                                        onclick="setup2FA()"
                                    >
                                        Set Up 2FA
                                    </button>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Session Management -->
                            <div class="form-group">
                                <label class="form-label">Active Sessions</label>
                                <div class="space-y-2">
                                    {% for session in active_sessions %}
                                    <div class="flex items-center justify-between py-2">
                                        <div>
                                            <div class="font-medium">{{ session.device }}</div>
                                            <div class="text-sm text-muted">Last active: {{ session.last_active }}</div>
                                        </div>
                                        <button 
                                            type="button"
                                            class="btn btn-outline btn-sm text-error"
                                            onclick="terminateSession('{{ session.id }}')"
                                        >
                                            Terminate
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                Save Security Settings
                            </button>
                        </form>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- üîπ Include Footer -->
    <footer role="contentinfo">
        <p>&copy; 2025 3AI. All rights reserved.</p>
    </footer>

    <!-- üîπ JavaScript -->
    <script type="module" src="/static/js/settings.js"></script>
</body>
</html>
