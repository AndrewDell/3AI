<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <!--
    📌 3AI Dashboard - Home Page
    ==========================================
    This serves as the main landing page for the 3AI platform.

    🔹 Features:
    - Provides an overview of the AI agent dashboard.
    - Displays dynamic agent activity and workflow status.
    - Modular and reusable layout.

    🔹 Best Practices:
    - Uses semantic HTML for accessibility.
    - Implements a modular layout with reusable header and footer components.
    - Fully responsive and mobile-friendly.

    ⏳ Last Updated: 2025-02-23
  -->

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="3AI Dashboard - Advanced AI Agent Management Platform">
  <meta name="theme-color" content="#2563eb">
  <meta name="csrf-token" content="{{ csrf_token() }}">
  
  <title>3AI Dashboard</title>

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  
  <!-- Preload Critical Assets -->
  <link rel="preload" href="/static/css/style.css" as="style">
  <link rel="modulepreload" href="/static/js/main.js">
  <link rel="preload" href="/static/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin>
  
  <!-- DNS Prefetch -->
  <link rel="dns-prefetch" href="https://api.3ai.com">
  
  <!-- Critical CSS -->
  <style>
    /* Inline critical CSS */
    :root { color-scheme: light dark; }
    .skeleton { 
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    @keyframes loading {
      to { background-position: -200% 0; }
    }
    .sr-only:not(:focus):not(:active) {
      clip: rect(0 0 0 0);
      clip-path: inset(50%);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }
  </style>

  <!-- Deferred CSS -->
  <link rel="stylesheet" href="/static/css/style.css" media="print" onload="this.media='all'">
  
  <!-- App Icons -->
  <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg">
  <link rel="apple-touch-icon" href="/static/images/apple-touch-icon.png">
  <link rel="manifest" href="/static/manifest.json">
</head>
<body class="min-h-full bg-surface antialiased">
  <!-- Skip Navigation -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-white focus:rounded">
    Skip to main content
  </a>

  <!-- Header -->
  {% include 'partials/header.html' %}

  <!-- Main Content -->
  <main id="main-content" class="container mx-auto px-4 py-8 space-y-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <h1 class="text-2xl font-bold">Dashboard Overview</h1>
      <div class="flex items-center gap-4">
        <div id="connection-status" class="px-3 py-1 rounded-full text-sm" role="status">
          <span class="flex items-center gap-2">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-success"></span>
            </span>
            Connected
          </span>
        </div>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Active Agents -->
      <section class="card" aria-labelledby="active-agents-title">
        <div class="p-4">
          <h2 id="active-agents-title" class="text-lg font-semibold mb-4">Active Agents</h2>
          <div class="agents-list space-y-4" aria-live="polite" role="list">
            <template id="agent-template">
              <div class="flex items-center justify-between p-3 bg-surface rounded-lg border border-border">
                <span class="agent-name font-medium"></span>
                <span class="agent-status text-sm"></span>
              </div>
            </template>
            <div class="skeleton h-12 rounded" aria-hidden="true"></div>
            <div class="skeleton h-12 rounded" aria-hidden="true"></div>
          </div>
        </div>
      </section>

      <!-- Performance Metrics -->
      <section class="card" aria-labelledby="performance-title">
        <div class="p-4">
          <h2 id="performance-title" class="text-lg font-semibold mb-4">Performance</h2>
          <div class="relative aspect-[4/3]">
            <canvas 
              id="performance-chart" 
              role="img"
              aria-label="Performance metrics chart showing agent activity over time"
            ></canvas>
          </div>
        </div>
      </section>

      <!-- Quick Actions -->
      <section class="card" aria-labelledby="quick-actions-title">
        <div class="p-4">
          <h2 id="quick-actions-title" class="text-lg font-semibold mb-4">Quick Actions</h2>
          <div class="space-y-3">
            <button 
              type="button"
              class="btn btn-primary w-full"
              id="start-agents"
              aria-label="Start all agents"
              data-action="start"
            >
              Start All Agents
            </button>
            <button 
              type="button"
              class="btn btn-outline w-full"
              id="stop-agents"
              aria-label="Stop all agents"
              data-action="stop"
            >
              Stop All Agents
            </button>
          </div>
        </div>
      </section>
    </div>

    <!-- Recent Activity -->
    <section class="card" aria-labelledby="recent-activity-title">
      <div class="card-header border-b border-border p-4">
        <h2 id="recent-activity-title" class="text-lg font-semibold">Recent Activity</h2>
      </div>
      <div class="p-4 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full min-w-[640px]" id="activity-table">
            <thead>
              <tr class="text-left border-b border-border">
                <th scope="col" class="p-3 font-semibold">Agent</th>
                <th scope="col" class="p-3 font-semibold">Action</th>
                <th scope="col" class="p-3 font-semibold">Status</th>
                <th scope="col" class="p-3 font-semibold">Time</th>
              </tr>
            </thead>
            <tbody>
              <template id="activity-row-template">
                <tr class="border-b border-border hover:bg-surface/50">
                  <td class="p-3"></td>
                  <td class="p-3"></td>
                  <td class="p-3"></td>
                  <td class="p-3"></td>
                </tr>
              </template>
              <tr class="skeleton" aria-hidden="true">
                <td colspan="4" class="h-12"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  {% include 'partials/footer.html' %}

  <!-- Scripts -->
  <script type="module">
    // Import dependencies and initialize
    import { initDashboard } from '/static/js/main.js';
    
    // Performance monitoring
    performance.mark('js-start');

    // Initialize dashboard with configuration
    initDashboard({
      wsEndpoint: '{{ ws_endpoint }}',
      updateInterval: 5000,
      debug: {{ debug|tojson }},
      theme: localStorage.getItem('theme') || 'light'
    });

    // Error boundary
    window.addEventListener('error', (event) => {
      console.error('Dashboard Error:', event.error);
      const status = document.getElementById('connection-status');
      if (status) {
        status.className = 'px-3 py-1 rounded-full text-sm bg-error/10 text-error';
        status.textContent = 'Connection Error';
      }
    });

    performance.mark('js-end');
    performance.measure('js-execution', 'js-start', 'js-end');
  </script>
</body>
</html>
